## Tencent

### WXG

> 2023.04.28—19:00-20:00

#### 1、[算法] [334. 递增的三元子序列 ](https://leetcode.cn/problems/increasing-triplet-subsequence/) &&[16. 最接近的三数之和](https://leetcode.cn/problems/3sum-closest/)

- 第一题没想到贪心的做法，太紧张也没找到 leftMin 和 rightMax 的写法，o(╥﹏╥)o
- 第二题直接秒了：排序+双指针



#### 2、deque 和 queue 的不同，底层实现

vector是单向开口（尾部）的连续线性空间，deque则是一种双向开口的连续线性空间，虽然 vector 也可以在头尾进行元素操作，但是其头部操作的效率十分低下（主要是涉及到整体的移动）

<img src="https://oss.interviewguide.cn/img/202205071953980.png" alt="img" style="zoom:67%;" />

deque 和 vector 的最大差异一个是 deque 运行在**常数时间**内对头端进行元素操作，二是 deque 没有容量的概念，它是动态地以分段连续空间组合而成，可以随时增加一段新的空间并链接起来

deque虽然也提供随机访问的迭代器，但是其迭代器并不是普通的指针，其复杂程度比vector高很多，因此除非必要，否则一般使用vector而非deque。如果需要对deque排序，可以先将deque中的元素复制到vector中，利用sort对vector排序，再将结果复制回deque

deque由一段一段的**定量连续空间**组成，一旦需要增加新的空间，只要配置一段定量连续空间拼接在头部或尾部即可，因此deque的最大任务是**如何维护这个整体的连续性**

```cpp
class deque
{
    ...
protected:
    typedef pointer* map_pointer;//指向map指针的指针
    map_pointer map;//指向map
    size_type map_size;//map的大小
public:
    ...
    iterator begin();
    iterator end();
    ...
}
```

deque内部有一个指针指向map，map是一小块连续空间，其中的每个元素称为**一个节点 node**，每个 node 都是一个指针，指向另一段较大的连续空间，称为**缓冲区**，这里就是deque中实际存放数据的区域，默认大小512bytes。结构如下：

<img src="https://oss.interviewguide.cn/img/202205220021453.png" alt="img" style="zoom:67%;" />



> stack 和 queue 是一种 container adapter，底层可以通过 deque 和 list 实现



#### 3、move 用在哪，是不是所有赋值都可以换成 move

- 和右值引用一起实现移动语义
- 肯定不是所有地方都使用 move，因为会将原有的左值置空

move 使用前提：① 定义的类使用了资源并定义了移动构造函数和移动赋值运算符；② 该变量即将不再使用



#### 4、MySQL 设计一张表怎样考虑，一张表很大怎么办

考虑表和字段的命名、字段类型和长度、索引设计、主键和外键的设计、数据库的范式理论

当一张表非常大时，可能会对性能和可维护性造成负面影响。以下是一些处理大表的常见技术：

1. 分区：将大表分成多个逻辑部分，以减少在单个表上执行的操作。例如，按时间范围将表分成多个分区，或者按地理位置将表分成多个分区。
2. **水平拆分**：将表中的行分成多个表。例如，按照某个关键字或 ID 将表拆分成多个表，可以减少在单个表上执行的操作，提高性能。
3. **垂直拆分**：将表中的列拆分成多个表。例如，将大表拆分为只包含少量高频列的主表和包含大量低频列的附属表，可以减少在读取数据时所需的 I/O 操作次数，提高性能。
4. **增加索引**：对于大表的查询操作，增加合适的索引可以加速查询速度。
5. 数据归档：将旧数据归档到其他存储介质，如归档到 Hadoop 或其他云服务平台。



#### 5、union 和 join 的区别

join 

- 内连接：也是等值连接，inner join

- 自连接：内连接的一种，连接表自身，更特殊的是自然连接，natrual join

  > 内连接和自然连接的区别：内连接提供连接的列，而自然连接自动连接所有同名列

- 外连接：左外连接 left outer join，右外连接 right outer join，全外连接

union

- 每个查询必须包含相同的列、表达式和聚集函数

- 默认会去除相同行，**如果需要保留相同行，使用 UNION ALL**
- 只能包含一个 ORDER BY 子句，并且必须位于语句的最后



#### 6、进程、线程、协程区别

1. 进程（Process）： 进程是操作系统资源分配的基本单位，每个进程都有独立的内存空间、独立的运行环境、独立的代码空间，它们之间通过进程间通信（IPC）来进行通信和协作。在Linux中，进程通过fork()系统调用创建，并可以通过exec()系统调用来替换自己的代码和数据。每个进程都有自己的pid（进程号）。
2. 线程（Thread）： 线程是进程内部的一条执行路径，多个线程可以共享进程的代码、数据和打开的文件等资源，但每个线程都有自己的栈空间。线程之间的通信和协作可以通过共享内存等方式实现。在Linux中，线程通过pthread_create()函数创建，它们共享同一个进程号。
3. 协程（Coroutine）： 协程是一种**用户态的轻量级线程**，它可以在同一个线程内部实现多个执行路径的切换，比线程更加轻量级，没有进程、线程上下文切换的开销。协程的切换是由程序员手动控制的，可以使用协程库来简化实现。在Linux中，协程可以使用第三方库（如Boost.Coroutine或Coroutine.h）实现。

**并不是所有的线程都可以替换成协程**

- 线程是由操作系统内核调度和管理的独立执行单元，它拥有自己的堆栈、寄存器和状态信息，可以通过系统调用实现阻塞、唤醒和同步等操作。而协程则是由程序员手动控制的执行单元，它共享线程的堆栈和寄存器，不需要系统调用，可以通过协作式调度实现非抢占式的多任务并发执行。
- **线程之间的切换需要内核介入**，会涉及到上下文切换和调度开销，需要保护和恢复线程的状态和资源，可能会导致性能和可伸缩性问题。而**协程之间的切换是在用户态完成的**，不需要内核介入，切换开销很小，不需要保护和恢复线程的状态和资源，可以实现更高的并发性和更低的延迟。
- **线程可以利用多核CPU的优势**，可以将多个线程分配到不同的CPU核心上并行执行。而**协程默认运行在同一个线程中**，不能直接利用多核CPU的优势，但是可以通过多线程加协程的方式实现并行执行。
- 线程是基于进程的，每个进程都有自己的虚拟地址空间和系统资源，不同进程之间的通信需要通过IPC机制实现。而协程没有自己的虚拟地址空间和系统资源，可以在同一个进程内共享数据和资源，通信方式更加简单和高效。



#### 7、TCP 如何保证可靠，流量控制和拥塞控制区别，TIME_WAIT 作用

- TCP 可靠性：校验和、分段、流量控制、拥塞控制、RTO 重传
- 流量控制是点到点/端到端的；拥塞控制是全局性的，涉及到所有的主机、路由器，以及与降低网络性能有关的所有因素
- TIME_WAIT 在四次挥手客户端这点收到 FIN 报文之后启动计时器



#### 8、HTTPS 如何实现可靠

在 HTTP 基础上基于 Transport Layer Secure/Secure Socket Layer 协议实现可靠传输，HTTP 默认 80 端口，HTTPS 默认 443 端口，HTTPS 需要到 Certificate Authority 申请数字证书，证书就是「数字签名+原信息」，里面包含服务器的公钥，客户端收到之后会将一个「随机值」（对称密钥）加密传输给服务端，服务端收到之后就可以通过这个「对称密钥」进行加密传输了

扩展：[如何用 UDP 实现可靠传输？](https://blog.csdn.net/qq_34827674/article/details/125144497)



#### 9、ping 的原理

Ping 的原理是通过向**目的主机发送 ICMP Echo 请求报文**，目的主机收到之后会发送 **Echo 回答报文**。Ping 会根据时间和成功响应的次数估算出**数据包往返时间以及丢包率**

ICMP 报文分为：

- 差错报告报文：终点不可达、时间超时、参数问题、改变路由
- 询问报文：会送 Echo 请求或回答、时间戳 Timestamp 请求或回答



### 腾讯音乐互娱

> 2023.06.15 19:30-20:10 —— QQ音乐后台 go 会员业务

- 自我介绍、单组播项目（码率、帧率多少）
- 多态 和 模版：模板实际上就是静态多态
- 1w 个字符串的数组，如何去重
- 进程线程区别，为什么线程切换开销比较大
- TCP 三次握手，第三次握手的 ACK 丢失会怎样

