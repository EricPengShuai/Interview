## çº¿æ®µæ ‘

> æœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹æ¥è‡ª [LFoolâš¡](https://leetcode.cn/u/lfool/) çš„åŠ›æ‰£é¢˜è§£ï¼šhttps://leetcode.cn/problems/my-calendar-ii/solution/by-lfool-nodi/ï¼Œå…·ä½“åœ¨å¤§ä½¬çš„ [åšå®¢](https://leetcode.cn/link/?target=https%3A%2F%2Flfool.github.io%2FLFool-Notes%2Falgorithm%2Fçº¿æ®µæ ‘è¯¦è§£.html) ä¹Ÿå¯ä»¥çœ‹åˆ°
>
> å¦å¤–å°éƒ¨åˆ†å‚è€ƒ [çº¿æ®µæ ‘ -- æ–°æ‰‹ç¯‡](https://leetcode.cn/problems/my-calendar-iii/solution/xian-duan-shu-by-xiaohu9527-rfzj/)



### 0. å®šä¹‰

çº¿æ®µæ ‘æ˜¯ä¸€ç§äºŒå‰æœç´¢æ ‘ï¼Œä¸åŒºé—´æ ‘ç›¸ä¼¼ï¼Œå®ƒå°†ä¸€ä¸ªåŒºé—´åˆ’åˆ†æˆä¸€äº›å•å…ƒåŒºé—´ï¼Œæ¯ä¸ªå•å…ƒåŒºé—´å¯¹åº”çº¿æ®µæ ‘ä¸­çš„ä¸€ä¸ªå¶ç»“ç‚¹ï¼Œ**å¯¹äºçº¿æ®µæ ‘ä¸­çš„æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ \[a, b], å®ƒçš„å·¦å„¿å­è¡¨ç¤ºçš„åŒºé—´ä¸º \[a, (a+b)/2], å³å„¿å­è¡¨ç¤ºçš„åŒºé—´ä¸º \[(a+b)/2+1, b]**ã€‚å› æ­¤çº¿æ®µæ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œæœ€åçš„å­èŠ‚ç‚¹æ•°ç›®ä¸º Nï¼Œå³ä¸ºæ•´ä¸ªçº¿æ®µåŒºé—´çš„é•¿åº¦ã€‚

ä½¿ç”¨çº¿æ®µæ ‘å¯ä»¥å¿«é€Ÿçš„æŸ¥æ‰¾ä¸€ä¸ªèŠ‚ç‚¹åœ¨è‹¥å¹²æ¡çº¿æ®µä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(logN)ï¼Œè€Œæœªä¼˜åŒ–çš„ç©ºé—´å¤æ‚åº¦ä¸º 2Nï¼Œå› æ­¤æœ‰æ—¶éœ€è¦ç¦»æ•£åŒ–è®©ç©ºé—´å‹ç¼©



**çº¿æ®µæ ‘è§£å†³çš„æ˜¯ã€ŒåŒºé—´å’Œã€é—®é¢˜ï¼Œå¹¶ä¸”è¯¥ã€ŒåŒºé—´ã€ä¼šè¢«ä¿®æ”¹**ã€‚ä¾‹å¦‚å¯¹äºä¸€ä¸ªæ•°ç»„ï¼Œå¤šæ¬¡æ±‚æŸä¸ªåŒºé—´çš„å’Œï¼Œå¯ä»¥ä½¿ç”¨ã€Œå‰ç¼€å’Œã€å®ç°ï¼Œä½†æ˜¯å¦‚æœåŒºé—´é‡Œé¢çš„å…ƒç´ ç»å¸¸å˜åŒ–æ—¶ã€Œå‰ç¼€å’Œã€çš„æ•ˆç‡å°±æ²¡é‚£ä¹ˆé«˜æ•ˆã€‚ä¸ºæ­¤å¼•å…¥çº¿æ®µæ ‘ï¼Œ**çº¿æ®µæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªåŒºé—´**ï¼Œå¯¹äºæ•°ç»„ `nums=[1, 2, 3, 4, 5]` å¯¹åº”çš„çº¿æ®µæ ‘ä¸ºï¼š

![çº¿æ®µæ ‘ç»“æ„](https://pic.leetcode-cn.com/1654588271-zbOpBr-1.svg)

**è¯´æ˜ï¼š**

1. æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªåŒºé—´ï¼ŒèŠ‚ç‚¹çš„å€¼å°±æ˜¯è¯¥åŒºé—´çš„å’Œ
2. èŠ‚ç‚¹çš„å€¼å¯ä»¥æ ¹æ®é¢˜ç›®è¦æ±‚æ¢æˆè‡ªå·±æ»¡è¶³**â€åŒºé—´åŠ æ³•â€œ**çš„è¡¨ç¤ºï¼Œä¾‹å¦‚
   - æœ€å¤§å…¬å› æ•° GCDï¼šæ€»GCD = gcd (å·¦åŒºé—´GCDï¼Œå³åŒºé—´GCD)
   - æœ€å¤§å€¼ï¼šæ€»æœ€å¤§å€¼ = max (å·¦åŒºé—´æœ€å¤§å€¼ï¼Œå³åŒºé—´æœ€å¤§å€¼)
3. æœ‰äº›ä¸ç¬¦åˆ **â€åŒºé—´åŠ æ³•â€œ** çš„è¡¨ç¤ºéœ€è¦æ³¨æ„ï¼Œä¾‹å¦‚ï¼š
   - ä¼—æ•°ï¼šæ ¹æ®å·¦å³åŒºé—´çš„ä¼—æ•°ä¸èƒ½æ±‚å‡ºæ€»åŒºé—´çš„ä¼—æ•°
   - 01åºåˆ—çš„æœ€é•¿è¿ç»­é›¶ï¼šæ ¹æ®å·¦å³åŒºé—´çš„æœ€é•¿è¿ç»­é›¶ï¼Œæ²¡æ³•çŸ¥é“æ€»çš„æœ€é•¿è¿ç»­é›¶
4. æ ¹èŠ‚ç‚¹ä»£è¡¨çš„åŒºé—´æ˜¯é—®é¢˜çš„æ€»åŒºé—´ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­æ•°æ®çš„é•¿åº¦å°±æ˜¯ \[0, 4]
5. çº¿æ®µæ ‘æ˜¯ä¸€æ£µè¿‘ä¼¼çš„å®Œå…¨äºŒå‰æ ‘ï¼Œå¦‚ä¸Šå›¾ï¼Œä½†ä¹Ÿæœ‰ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘çš„æƒ…å†µ
6. å»ºç«‹çº¿æ®µæ ‘çš„è¿‡ç¨‹å°±æ˜¯ä¸æ–­æŠŠåŒºé—´**ã€Œå¹³åˆ†ã€**çš„è¿‡ç¨‹ï¼Œç›´åˆ°åŒºé—´é•¿åº¦ä¸º1



### 1. åŸºæœ¬æ“ä½œ

**æ•°æ®ç»“æ„**ï¼šç”±äºçº¿æ®µæ ‘æ˜¯ä¸€æ£µè¿‘ä¼¼çš„å®Œå…¨äºŒå‰æ ‘ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨äºŒå‰æ ‘çš„ç»“æ„è¡¨ç¤º

```cpp
class Node {
  	int val;	// å½“å‰èŠ‚ç‚¹å€¼
  	Node* left, right;	// å·¦å³å­©å­èŠ‚ç‚¹
  	Node(int a=0): val(a), left(nullptr), right(nullptr) {};
  	~Node() {
      	delete left;
      	delete right;
    }
}
```



**å»ºç«‹çº¿æ®µæ ‘**

1. å¦‚æœé¢˜ç›®ä¸­ç»™äº†å…·ä½“çš„åŒºé—´èŒƒå›´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®èŒƒå›´å»ºç«‹çº¿æ®µæ ‘

   ```cpp
   void buildTree(Node* node, int start, int end) {
     	// åˆ°è¾¾å¶å­èŠ‚ç‚¹
     	if (start == end) {
         	node->val = arr[start];
         	return ;
       }
     	int mid = (start + end) / 2;
     	buildTree(node->left, start, mid);
     	buildTree(node->right, mid+1, end);
     	
     	// å‘ä¸Šæ›´æ–°
     	pushUp(node);
   }
   
   void pushUp(Node* node) {
     	node->val = node->left->val + node->right->val;
   }
   ```

2. å¯¹äºæ²¡æœ‰å…·ä½“èŒƒå›´çš„æƒ…å†µï¼Œä¸€èˆ¬åªæœ‰æ•°æ®çš„å–å€¼èŒƒå›´ï¼Œä¸€èˆ¬éƒ½å¾ˆå¤§ï¼Œå¯ä»¥ä½¿ç”¨**ã€ŒåŠ¨æ€å¼€ç‚¹ã€**ï¼Œä¾‹å¦‚åˆšå¼€å§‹æˆ‘ä»¬åªçŸ¥é“æ•°ç»„çš„é•¿åº¦ä¸º5ï¼Œä¸çŸ¥é“æ•°ç»„å†…æ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªæ·»åŠ è¿›å»çš„ï¼Œæ­¤æ—¶éœ€è¦åŠ¨æ€å¼€ç‚¹ï¼Œä¾‹å¦‚åˆšå¼€å§‹çš„èŠ‚ç‚¹å°±åªèƒ½æ˜¯ `[0, 4]; val = 0`ï¼Œæ­¤æ—¶æ·»åŠ å…ƒç´  `[2, 2]; val = 3`ï¼Œçº¿æ®µæ ‘å˜ä¸ºï¼š

   ![åŠ¨æ€å¼€ç‚¹1](https://pic.leetcode-cn.com/1655808231-VTJvAM-2.svg)

   è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å·¦å³å­©å­ï¼Œä¼šä¸€ä¸‹å­æŠŠå·¦å³å­©å­èŠ‚ç‚¹éƒ½ç»™åˆ›å»ºå‡ºæ¥ï¼Œå¦‚ä¸Šå›¾æ©™è‰²èŠ‚ç‚¹æ‰€ç¤ºï¼Œå…·ä½“ä»£ç å¯è§æ–¹æ³• `pushDown()`

   ä¸¤ä¸ªæ©™è‰²çš„å¶å­èŠ‚ç‚¹ä»…ä»…åªæ˜¯è¢«åˆ›å»ºå‡ºæ¥äº†ï¼Œå¹¶æ— å®é™…çš„å€¼ï¼Œå‡ä¸º 0ï¼›è€Œå¦å¤–ä¸€ä¸ªæ©™è‰²çš„éå¶å­èŠ‚ç‚¹ï¼Œå€¼ä¸º 3 çš„åŸå› æ˜¯ä¸‹é¢çš„å­©å­èŠ‚ç‚¹çš„å€¼å‘ä¸Šæ›´æ–°å¾—åˆ°çš„

   **ä¸‹é¢ç»™å‡ºä¾æ¬¡æ·»åŠ å‰©ä½™èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼š(æ³¨æ„è§‚å¯Ÿå€¼çš„å˜åŒ–ï¼ï¼)**

   ![åŠ¨æ€å¼€ç‚¹2](https://pic.leetcode-cn.com/1655808224-kMYiyq-3.svg)

> ã€ŒåŠ¨æ€å¼€ç‚¹ã€ä¸€èˆ¬æ˜¯åœ¨ã€Œæ›´æ–°ã€æˆ–ã€ŒæŸ¥è¯¢ã€çš„æ—¶å€™åŠ¨æ€çš„å»ºç«‹èŠ‚ç‚¹ï¼Œå…·ä½“å¯è§ä¸‹é¢çš„**æ›´æ–°**å’Œ**æŸ¥è¯¢**æ“ä½œ



**æ›´æ–°çº¿æ®µæ ‘**ï¼šå°†æŒ‡å®šåŒºé—´å¦‚ \[2, 4] çš„å…ƒç´ éƒ½å¢åŠ 1

![æ›´æ–°çº¿æ®µæ ‘](https://pic.leetcode-cn.com/1654588378-Bhkpkc-3.svg)

æ›´æ–°çš„å‰ææ˜¯æŸ¥è¯¢éœ€è¦æ›´æ–°çš„åŒºé—´ï¼Œé¦–å…ˆæŸ¥æ‰¾åˆ°åŒºé—´ \[2, 2] å’Œ \[3, 4]ï¼Œç„¶åæ›´æ–°èŠ‚ç‚¹ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯æ›´æ–°è¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„è¯ä¹Ÿæœ‰é—®é¢˜ï¼Œå› ä¸º \[3, 3] å’Œ \[4, 4] ä¹Ÿéœ€è¦æ›´æ–°ï¼Œå½“æŸ¥è¯¢å®ƒä»¬æ—¶æ‰å¯ä»¥å¾—åˆ°æ›´æ–°ä¹‹åçš„å€¼ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç»™èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªã€Œæ‡’æƒ°æ ‡è®°ã€ï¼Œç»™æ›´æ–°åŒºé—´çš„å¯¹åº”èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ‡’æƒ°æ ‡è®°ï¼Œ**è¡¨ç¤ºè¯¥èŠ‚ç‚¹æ‰€æœ‰å¯¹åº”çš„å­©å­èŠ‚ç‚¹éƒ½åº”è¯¥æœ‰æ­¤æ¬¡æ›´æ–°**ï¼Œå½“å‘å­©å­èŠ‚ç‚¹éå†çš„æ—¶å€™ä¼šæŠŠã€Œæ‡’æƒ°æ ‡è®°ã€ä¸‹æ¨ç»™å­©å­èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨æœ€ä¼˜å­©å­èŠ‚ç‚¹æ—¶éœ€è¦åˆ›å»ºå·¦å³å­©å­èŠ‚ç‚¹ï¼Œæœ€ç»ˆæˆ‘ä»¬ä¿®æ”¹ Node çš„æ•°æ®ç»“æ„ï¼š

```cpp
class Node {
  	int val;	// å½“å‰èŠ‚ç‚¹å€¼
  	int lazy; 	// æ·»åŠ çš„æ‡’æƒ°æ ‡è®°
  	Node* left, right;	// å·¦å³å­©å­èŠ‚ç‚¹
  	Node(int a=0): val(a), left(nullptr), right(nullptr) {};
  	~Node() {
      	delete left;
      	delete right;
    }
}
```

ã€ä¸‹æ¨æ‡’æƒ°æ ‡è®°ã€å‡½æ•°ï¼š

```cpp
// leftNum å’Œ rightNum è¡¨ç¤ºå·¦å³å­©å­åŒºé—´çš„å¶å­èŠ‚ç‚¹æ•°é‡
void pushDown(Node* node, int leftNum, int rightNum) {
  	if (node->left == nullptr) node->left = new Node();
  	if (node->right == nullptr) node->right = new Node();
  
  	// æ²¡æœ‰æ ‡è®°ç›´æ¥è¿”å›
  	if (node->lazy == 0) return;
  	// å¦‚æœæ˜¯ã€ŒåŠ å‡ã€æ›´æ–°æ“ä½œå°±éœ€è¦ä½¿ç”¨ï¼šæ ‡è®°å€¼ * å­æ ‘æ‰€æœ‰å¶å­èŠ‚ç‚¹æ•°é‡
  	node->left->val += node->lazy * leftNum;
  	node->right->val += node->lazy * rightNum;
  	// å¯¹åŒºé—´è¿›è¡Œã€ŒåŠ å‡ã€çš„æ›´æ–°æ“ä½œï¼Œä¸‹æ¨æ‡’æƒ°æ ‡è®°æ—¶éœ€è¦ç´¯åŠ èµ·æ¥ï¼Œä¸èƒ½ç›´æ¥è¦†ç›–
  	node->left->lazy += node->lazy;
  	node->right->lazy += node->lazy;
  	// å–æ¶ˆå½“å‰èŠ‚ç‚¹çš„æ ‡è®°
  	node->lazy = 0;
}
```

ã€Œæ›´æ–°æœ€ç»ˆå‡½æ•°ã€ï¼š

```cpp
// åœ¨ start...end èŒƒå›´å†…æ›´æ–° l...r åŒºé—´ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œéƒ½åŠ  val
void update(Node* node, int start, int end, int l, int r, int val) {
  	// æ‰¾åˆ°æ»¡è¶³è¦æ±‚çš„åŒºé—´
  	if (l <= start && end <= r) {
      	// åŒºé—´èŠ‚ç‚¹åŠ ä¸Šå­æ ‘æ‰€æœ‰å¶å­èŠ‚ç‚¹
      	node->val += (end - start + 1) * val;
      	// ç´¯è®¡æ·»åŠ æ‡’æƒ°æ ‡è®°
      	node->lazy += val;
      	return ;
    }
  	int mid = (start + end) / 2;
  	// ä¸‹æ¨æ ‡è®°ï¼Œmid - start + 1 è¡¨ç¤ºå·¦å­©å­åŒºé—´å¶å­èŠ‚ç‚¹æ•°é‡ï¼Œend - mid è¡¨ç¤ºå³å­©å­åŒºé—´å¶å­èŠ‚ç‚¹æ•°é‡
  	pushDown(node, mid - start + 1, end - mid);
  	if (l <= mid) update(node->left, start, mid, l, r, val);
  	if (r > mid) update(node->right, mid + 1, end, l, r, val);
  	// å‘ä¸Šæ›´æ–°
    pushUp(node);
}
```



**æŸ¥è¯¢çº¿æ®µæ ‘**ï¼šæŸ¥è¯¢æŸä¸€ä¸ªåŒºé—´å¦‚ \[2, 4] çš„ç»“æœï¼ˆå›¾ä¸­çº¢è‰²æ ‡è®°ï¼‰å¹¶è¿”å›

![æŸ¥è¯¢çº¿æ®µæ ‘](https://pic.leetcode-cn.com/1654588328-LNnVpz-2.svg)

```cpp
// åœ¨åŒºé—´ [start, end] ä¸­æŸ¥è¯¢åŒºé—´ [l, r] çš„ç»“æœï¼Œæ³¨æ„ [l, r] ä¿æŒä¸å˜
int query(Node* node, int start, int end, int l , int r) {
  	// åŒºé—´ [l ,r] å®Œå…¨åŒ…å«åŒºé—´ [start, end]
    // ä¾‹å¦‚ï¼š[2, 4] = [2, 2] + [3, 4]ï¼Œå½“ [start, end] = [2, 2] æˆ–è€… [start, end] = [3, 4]ï¼Œç›´æ¥è¿”å›
  	if (l <= start && end <= r) {
      	return node->val;
    }
  	
  	// æŠŠå½“å‰åŒºé—´ [start, end] å‡åˆ†å¾—åˆ°å·¦å³å­©å­çš„åŒºé—´èŒƒå›´
    // node å·¦å­©å­åŒºé—´ [start, mid]
    // node å·¦å­©å­åŒºé—´ [mid + 1, end]
  	int mid = (start + end) / 2;
  	int ans = 0;
  	pushDown(node, mid - start + 1, end - mid);
  	if (l <= mid) {
      	ans += query(node, start, mid, l, r);
    }
  	if (r > mid) {
      	ans += query(node->right, mid + 1, end, l, r);
    }
  	return ans;
}
```



### 2. å®Œæ•´æ¨¡æ¿

**åŸºäºæ±‚ã€ŒåŒºé—´å’Œã€ä»¥åŠå¯¹åŒºé—´è¿›è¡Œã€ŒåŠ å‡ã€çš„æ›´æ–°æ“ä½œçš„å¸¸è§„æ¨¡æ¿**

```cpp
// çº¿æ®µæ ‘ä»£ç 
#include <iostream>
#include <vector>
using namespace std;

// node_idx ä¸ºçº¿æ®µæ ‘ä¸‹æ ‡ï¼Œä»1å¼€å§‹å–
void build_tree(vector<int>& arr, vector<int>& tree, int start, int end, int node_idx)
{
    //é€’å½’çš„å‡ºå£ï¼Œä¹Ÿå°±æ˜¯åˆ°äº†å¶å­èŠ‚ç‚¹
    if(start == end) {
        tree[node_idx] = arr[start];
    } else {
        //æ‰¾åˆ°å·¦å­æ ‘çš„èŠ‚ç‚¹(2*node_idx)
        //æ‰¾åˆ°å³å­æ ‘çš„èŠ‚ç‚¹(2*node_idx+1)
        int left_node = 2*node_idx, right_node = 2*node_idx + 1;
        int mid = (start + end) / 2;
        //å°†æ ‘è¿›è¡Œåˆ†å‰²ï¼Œç„¶åå·¦å³é€’å½’å»ºæ ‘
        build_tree(arr, tree, start, mid, left_node);
        build_tree(arr, tree, mid+1, end, right_node);
        tree[node_idx] = tree[left_node] + tree[right_node];
    }
}

// æŸ¥è¯¢ [l, r] çš„åŒºé—´å’Œï¼Œnode_idx ä»1å¼€å§‹
int query(vector<int>& arr, vector<int>& tree, int start, int end, int l, int r, int node_idx)
{
    //æƒ…å†µä¸€
    if(l > end || r < start) {
        return 0;
    } else if (l <= start && end <= r) { //æƒ…å†µäºŒ
        return tree[node_idx];
    } else {
        //é€’å½’æŸ¥è¯¢
        //æ‰¾åˆ°å·¦å­æ ‘çš„èŠ‚ç‚¹(2*node_idx)
        //æ‰¾åˆ°å³å­æ ‘çš„èŠ‚ç‚¹(2*node_idx+1)
        int left_node = 2*node_idx, right_node = 2*node_idx + 1;
        int mid = (start + end) / 2;
        //å°†æ ‘è¿›è¡Œåˆ†å‰²ï¼Œç„¶åå·¦å³é€’å½’æŸ¥è¯¢
        int left_sum = query(arr, tree, start, mid, l, r, left_node);
        int right_sum = query(arr, tree, mid+1, end, l, r, right_node);
        return left_sum + right_sum;
    }
}

// æ›´æ–°æŒ‡å®šä¸‹æ ‡ update_idx çš„å…ƒç´ ï¼Œnode_idx ä»1å¼€å§‹å–
void update(vector<int>& arr, vector<int>& tree, int start, int end, int node_idx, int update_idx, int val)
{
    //é€’å½’çš„å‡ºå£ï¼Œä¹Ÿå°±æ˜¯åˆ°äº†å¶å­èŠ‚ç‚¹, æ›´æ–°å…¶å€¼
    if(start == end) {
        tree[node_idx] = arr[start] = val;
    } else {
        //æ‰¾åˆ°å·¦å­æ ‘çš„èŠ‚ç‚¹(2*node_idx)
        //æ‰¾åˆ°å³å­æ ‘çš„èŠ‚ç‚¹(2*node_idx+1)
        int left_node = 2*node_idx, right_node = 2*node_idx + 1;
        int mid = (start + end) / 2;
        //å¦‚æœè¦æ›´æ–°èŠ‚ç‚¹åœ¨å³è¾¹
        if(update_idx > mid) {
            update(arr, tree, mid+1, end, right_node, update_idx, val);
        } else { //è¦æ›´æ–°èŠ‚ç‚¹åœ¨å·¦è¾¹
            update(arr, tree, start, mid, left_node, update_idx, val);
        }
        //è¦æ³¨æ„æ›´æ–°å½“å‰èŠ‚ç‚¹ï¼ï¼ï¼ï¼ï¼ï¼
        tree[node_idx] = tree[left_node] + tree[right_node];
    }
}

int main()
{
    vector<int> arr = {93, 90, 50, 50, 1};
    int n = arr.size();
    vector<int> tree(4*n);
    build_tree(arr, tree, 0, n-1, 1);
    cout << "æ›´æ–°å‰çš„æ ‘:";
    for (auto& x : tree) cout << x << " ";
    cout << endl;
    
    //æ›´æ–° idx = 4çš„å…ƒç´ å€¼ä¸º 2
    update(arr, tree, 0, n-1, 1, 4, 2);
    cout << "æ›´æ–°åçš„æ ‘:";
    for (auto& x : tree) cout << x << " ";
    cout << endl;
    
    cout << "æŸ¥è¯¢åŒºé—´[2,4]çš„å’Œä¸ºï¼š" << query(arr, tree, 0, n-1, 2, 4, 1) << endl;

    return 0;
}
```



**åŸºäºæ±‚ã€ŒåŒºé—´å’Œã€ä»¥åŠå¯¹åŒºé—´è¿›è¡Œã€ŒåŠ å‡ã€çš„æ›´æ–°æ“ä½œï¼Œä¸”ä¸ºã€ŒåŠ¨æ€å¼€ç‚¹ã€çš„æ¨¡æ¿**

```cpp
struct Node {
		int lazy;
  	int val;
  	Node* left;
    Node* right;
  	Node(int a = 0): val(a), lazy(0), left(nullptr), right(nullptr) {}; 
};

class SegmentTree {
private:
  	Node* root;
public:
  	SegmentTree() {
      	root = new Node();
    }
  	
  	// æ›´æ–° [l, r] åŒºé—´é‡Œé¢å…ƒç´ 
  	void update(Node* node, int start, int end, int l, int r, int val) {
      	if (l <= start && end <= r) {
          	node->val += (end - start + 1) * val;
          	node->lazy += val;
          	return;
        }
      	
      	int mid = (start + end) / 2;
      	// ä¸‹æ¨æ‡’æƒ°æ ‡è®°
      	pushDown(node, mid - start + 1, end - mid);
      	if (l <= mid) update(node->left, start, mid, l, r, val);
      	if (r > mid) update(node->right, mid + 1, end, l, r, val);
      	pushUp(node);
    }
  
  	int query(Node* node, int start, int end, int l, int r) {
      	if (l <= start && end <= r) return node->val;
      	int mid = (start + end) / 2;
      	int ans = 0;
      	pushDown(node, mid - start + 1, end - mid);
      	if (l <= mid) ans += query(node->left, start, mid, l, r);
      	if (r > mid) ans += query(node->right, mid + 1, end, l, r);
      	return ans;
    }
  	
  	void pushDown(Node* node, int leftNum, int rightNum) {
      	if (node->left == nullptr) node->left = new Node();
      	if (node->right == nullptr) node->right = new Node();
      	
      	if (node->lazy == 0) return ;
      	node->left->val += node->lazy * leftNum;
      	node->right->val += node->lazy * rightNum;
      	
      	// æ›´æ–°æ‡’æƒ°æ ‡è®°
      	node->left->lazy += node->lazy;
      	node->right->lazy += node->lazy;
      	node->lazy = 0;
    }
  	
  	// è¿™é‡Œå¦‚æœä¸æ˜¯ç»´æŠ¤åŒºé—´å’Œéœ€è¦æ³¨æ„æ”¹å˜
  	void pushUp(Node* node) {
      	node->val = node->left->val + node->right->val;
    }
};
```





### 3. å¸¸è§é¢˜å‹

| é¢˜ç›®                                                         | è¯´æ˜                                                         | é¢˜è§£                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| [729. æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ I](https://leetcode.cn/problems/my-calendar-i/) | ç»´æŠ¤**åŒºé—´æœ€å€¼**å¹¶å¯¹åŒºé—´è¿›è¡Œ**åŠ å‡æ›´æ–°**ï¼Œæš´åŠ›ç»´æŠ¤æ¯”è¾ƒç®€å•   | [è§£](https://leetcode.cn/problems/my-calendar-i/solution/by-lfool-xvpv/) |
| [731. æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ II](https://leetcode.cn/problems/my-calendar-ii/) | ç»´æŠ¤**åŒºé—´æœ€å€¼**å¹¶å¯¹åŒºé—´è¿›è¡Œ**åŠ å‡æ›´æ–°**ï¼Œæš´åŠ›ç»´æŠ¤æ¯”è¾ƒç®€å•   | [è§£](https://leetcode.cn/problems/my-calendar-ii/solution/by-lfool-nodi/) |
| [732. æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ III](https://leetcode.cn/problems/my-calendar-iii/) | ç»´æŠ¤**åŒºé—´æœ€å€¼**å¹¶å¯¹åŒºé—´è¿›è¡Œ**åŠ å‡æ›´æ–°**ï¼Œå·®åˆ†æ•°ç»„           | [è§£](https://leetcode.cn/problems/my-calendar-iii/solution/xian-duan-shu-by-xiaohu9527-rfzj/) |
| [307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode.cn/problems/range-sum-query-mutable/) | ç»´æŠ¤**åŒºé—´å’Œ**å¹¶å¯¹åŒºé—´è¿›è¡Œ**è¦†ç›–æ›´æ–°**ï¼Œå‚è€ƒé¢˜è§£çš„ç¬¬äºŒä»½cppä»£ç  | [è§£](https://leetcode.cn/problems/my-calendar-iii/solution/xian-duan-shu-by-xiaohu9527-rfzj/) |
| [933. æœ€è¿‘çš„è¯·æ±‚æ¬¡æ•°](https://leetcode.cn/problems/number-of-recent-calls/) | ç»´æŠ¤**åŒºé—´å’Œ**å¹¶å¯¹åŒºé—´è¿›è¡Œ**åŠ å‡æ›´æ–°**ï¼Œç›´æ¥**é˜Ÿåˆ—**å°±å¯ä»¥   | [è§£](https://leetcode.cn/problems/number-of-recent-calls/solution/by-nehzil-9het/) |



### 4. æ€»ç»“

çº¿æ®µæ•°åœ¨å¤šæ¬¡æ±‚å–ã€ŒåŒºé—´å’Œã€é—®é¢˜ä¸Šå…·æœ‰ä¼˜åŠ¿ï¼Œä½†æ˜¯å®é™…é¢è¯•æ¯”è¾ƒéš¾æƒ³å‡ºæ¥ï¼Œè€Œä¸”å®é™…ä½“å‹ä¸­ä½¿ç”¨å¸¸è§„çš„æ–¹æ³•å¦‚æš´åŠ›ç»´æŠ¤ã€å·®åˆ†æ•°ç»„ç­‰å¯èƒ½æ¯”ç›´æ¥ç»´æŠ¤ \[0, 1e9] ä¸Šçš„çº¿æ®µæ ‘æ—¶é—´å¤æ‚åº¦ä½ï¼Œå› æ­¤è¿™ä¸ªæ•°æ®ç»“æ„å…ˆç®€å•äº†è§£å°±å¥½ï¼Œå…·ä½“ç†Ÿç»ƒæŒæ¡å¯èƒ½æœ‰ç‚¹éš¾åº¦ã€‚

- å¯¹äºè¡¨ç¤ºä¸º**ã€ŒåŒºé—´å’Œã€**ä¸”å¯¹åŒºé—´è¿›è¡Œ**ã€ŒåŠ å‡ã€**çš„æ›´æ–°æ“ä½œçš„æƒ…å†µï¼Œæˆ‘ä»¬åœ¨æ›´æ–°èŠ‚ç‚¹å€¼çš„æ—¶å€™ã€éœ€è¦âœ–ï¸å·¦å³å­©å­åŒºé—´å¶å­èŠ‚ç‚¹çš„æ•°é‡ (æ³¨æ„æ˜¯å¶å­èŠ‚ç‚¹çš„æ•°é‡)ã€ï¼›æˆ‘ä»¬åœ¨ä¸‹æ¨æ‡’æƒ°æ ‡è®°çš„æ—¶å€™ã€éœ€è¦ç´¯åŠ ã€ï¼ï¼(è¿™ç§æƒ…å†µå’Œæ¨¡ç‰ˆä¸€è‡´ï¼ï¼) å¦‚é¢˜ç›® 933.æœ€è¿‘çš„è¯·æ±‚æ¬¡æ•°
- å¯¹äºè¡¨ç¤ºä¸º**ã€ŒåŒºé—´å’Œã€**ä¸”å¯¹åŒºé—´è¿›è¡Œ**ã€Œè¦†ç›–ã€**çš„æ›´æ–°æ“ä½œçš„æƒ…å†µï¼Œæˆ‘ä»¬åœ¨æ›´æ–°èŠ‚ç‚¹å€¼çš„æ—¶å€™ã€éœ€è¦âœ–ï¸å·¦å³å­©å­åŒºé—´å¶å­èŠ‚ç‚¹çš„æ•°é‡ (æ³¨æ„æ˜¯å¶å­èŠ‚ç‚¹çš„æ•°é‡)ã€ï¼›æˆ‘ä»¬åœ¨ä¸‹æ¨æ‡’æƒ°æ ‡è®°çš„æ—¶å€™ã€ä¸éœ€è¦ç´¯åŠ ã€ï¼ï¼(å› ä¸ºæ˜¯è¦†ç›–æ“ä½œï¼ï¼) å¦‚é¢˜ç›® 307.åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹
- å¯¹äºè¡¨ç¤ºä¸º**ã€ŒåŒºé—´æœ€å€¼ã€**ä¸”å¯¹åŒºé—´è¿›è¡Œ**ã€ŒåŠ å‡ã€**çš„æ›´æ–°æ“ä½œçš„æƒ…å†µï¼Œæˆ‘ä»¬åœ¨æ›´æ–°èŠ‚ç‚¹å€¼çš„æ—¶å€™ã€ä¸éœ€è¦âœ–ï¸å·¦å³å­©å­åŒºé—´å¶å­èŠ‚ç‚¹çš„æ•°é‡ (æ³¨æ„æ˜¯å¶å­èŠ‚ç‚¹çš„æ•°é‡)ã€ï¼›æˆ‘ä»¬åœ¨ä¸‹æ¨æ‡’æƒ°æ ‡è®°çš„æ—¶å€™ã€éœ€è¦ç´¯åŠ ã€ï¼ï¼ å¦‚é¢˜ç›® 729.æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ Iã€732.æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ III

> æ³¨æ„ï¼šå¯¹äºé¢˜ç›® [æœ€è¿‘çš„è¯·æ±‚æ¬¡æ•°](https://leetcode.cn/problems/number-of-recent-calls/) å’Œ [åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode.cn/problems/range-sum-query-mutable/) å¯ä»¥ã€Œä¸ç”¨âœ–ï¸å·¦å³å­©å­åŒºé—´å¶å­èŠ‚ç‚¹çš„æ•°é‡ã€
>
> å› ä¸ºè¿™ä¸¤ä¸ªé¢˜ç›®æ˜¯ã€Œç‚¹æ›´æ–°ã€ï¼Œã€Œç‚¹æ›´æ–°ã€å’Œã€ŒåŒºé—´æ›´æ–°ã€å¯ä»¥åˆå¹¶æˆä¸€ç§ï¼Œã€Œç‚¹æ›´æ–°ã€å°±æ˜¯æ›´æ–°é•¿åº¦ä¸º 1 çš„ã€ŒåŒºé—´æ›´æ–°ã€
>



### 5. å‚è€ƒ

- [çº¿æ®µæ ‘è¯¦è§£ã€Œæ±‡æ€»çº§åˆ«æ•´ç† ğŸ”¥ğŸ”¥ğŸ”¥ã€](https://leetcode.cn/problems/my-calendar-ii/solution/by-lfool-nodi/)
- [å°è™ï¼šçº¿æ®µæ ‘ -- æ–°æ‰‹ç¯‡](https://leetcode.cn/problems/my-calendar-iii/solution/xian-duan-shu-by-xiaohu9527-rfzj/)

